<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="HardenSystemSecurity.Pages.Protects.BitLocker"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:bitLocker="using:HardenSystemSecurity.BitLocker"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:win="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:customUI="using:AppControlManager.CustomUIElements"
    FlowDirection="{x:Bind ViewModel.AppSettings.ApplicationGlobalFlowDirection, Mode=OneWay}">

    <!-- Gradient brush for key protector borders -->
    <Page.Resources>
        <LinearGradientBrush x:Key="KeyProtectorBorderBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FF0099" Offset="0"/>
            <GradientStop Color="#493240" Offset="1"/>
        </LinearGradientBrush>
    </Page.Resources>

    <Grid>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <customUI:InfoBarV2 Grid.Row="0"
                            IsOpen="{x:Bind ViewModel.MainInfoBarIsOpen, Mode=TwoWay}"
                            Message="{x:Bind ViewModel.MainInfoBarMessage, Mode=OneWay}"
                            Severity="{x:Bind ViewModel.MainInfoBarSeverity, Mode=OneWay}"
                            IsClosable="{x:Bind ViewModel.MainInfoBarIsClosable, Mode=OneWay}" />

        <TabView VerticalAlignment="Stretch"
                 IsAddTabButtonVisible="False"
                 Grid.Row="1"
                 TabWidthMode="Equal"
                 CanReorderTabs="{x:Bind ViewModel.IsNotElevated}">

            <!-- Security Measures Tab -->
            <TabViewItem x:Uid="BitLockerSecurityMeasuresTab" IsClosable="False" MinHeight="40">
                <TabViewItem.IconSource>
                    <BitmapIconSource UriSource="/Assets/External/SecurityMeasures.png" ShowAsMonochrome="False" />
                </TabViewItem.IconSource>
                <TabViewItem.Content>
                    <Grid>
                        <win:Grid.ChildrenTransitions>
                            <win:EntranceThemeTransition FromVerticalOffset="50" />
                            <win:RepositionThemeTransition IsStaggeringEnabled="False" />
                        </win:Grid.ChildrenTransitions>

                        <!-- Set DisposeOnlyOnExplicitCall + ChildButtonsDisposeOnlyOnExplicitCall to defer disposal to navigation. -->
                        <customUI:MUnitListViewControl x:Name="SecurityMeasuresList"
                                  DisposeOnlyOnExplicitCall="True"
                                  ChildButtonsDisposeOnlyOnExplicitCall="True"
                                  ViewModel="{x:Bind ViewModel}"
                                  ListViewItemsSource="{x:Bind ViewModel.ListViewItemsSource, Mode=OneWay}"/>
                    </Grid>
                </TabViewItem.Content>
            </TabViewItem>

            <!-- Management -->
            <TabViewItem x:Uid="BitLockerManagementTab" IsClosable="False" MinHeight="40">
                <TabViewItem.IconSource>
                    <BitmapIconSource UriSource="/Assets/External/Management.png" ShowAsMonochrome="False" />
                </TabViewItem.IconSource>
                <TabViewItem.Content>
                    <Grid>
                        <win:Grid.ChildrenTransitions>
                            <win:EntranceThemeTransition FromVerticalOffset="50" />
                            <win:RepositionThemeTransition IsStaggeringEnabled="False" />
                        </win:Grid.ChildrenTransitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Margin="0,10,0,10" Grid.Row="0" Style="{StaticResource GridCardStyle}" Padding="8">
                            <controls:WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                HorizontalSpacing="10"
                                                VerticalSpacing="10">

                                <ProgressRing Visibility="{x:Bind ViewModel.BitLockerProgressVisibility, Mode=OneWay}"
                                              HorizontalAlignment="Center"
                                              IsIndeterminate="True"/>

                                <Button x:Uid="RetrieveBitLockerVolumesButton"
                                        VerticalAlignment="Center"
                                        IsEnabled="{x:Bind ViewModel.BitLockerUiEnabled, Mode=OneWay}"
                                        Click="{x:Bind ViewModel.RetrieveBitLockerVolumes}">
                                    <Button.ContentTemplate>
                                        <DataTemplate x:DataType="x:String">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon Glyph="&#xE9F5;" FontSize="16"/>
                                                <TextBlock Text="{x:Bind}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>

                                <DropDownButton x:Uid="BitLockerEncryptionDropDownButton"
                                                IsEnabled="{x:Bind ViewModel.BitLockerUiEnabled, Mode=OneWay}">
                                    <DropDownButton.Flyout>
                                        <MenuFlyout Placement="Bottom">
                                            <MenuFlyoutItem x:Uid="EncryptMenuFlyoutItem"
                                                            IsEnabled="{x:Bind ViewModel.BitLockerUiEnabled, Mode=OneWay}"
                                                            Icon="{ui:FontIcon Glyph=&#xE72E;}"
                                                            Click="{x:Bind ViewModel.EncryptVolume}" />
                                            <MenuFlyoutItem x:Uid="DecryptMenuFlyoutItem"
                                                            IsEnabled="{x:Bind ViewModel.BitLockerUiEnabled, Mode=OneWay}"
                                                            Icon="{ui:FontIcon Glyph=&#xE785;}"
                                                            Click="{x:Bind ViewModel.DecryptVolume}" />
                                            <MenuFlyoutItem x:Uid="SuspendMenuFlyoutItem"
                                                            IsEnabled="{x:Bind ViewModel.IsSuspendFeatureEnabled, Mode=OneWay}"
                                                            Icon="{ui:FontIcon Glyph=&#xE769;}"
                                                            Click="{x:Bind ViewModel.SuspendVolume}" />
                                            <MenuFlyoutItem x:Uid="ResumeMenuFlyoutItem"
                                                            IsEnabled="{x:Bind ViewModel.BitLockerUiEnabled, Mode=OneWay}"
                                                            Icon="{ui:FontIcon Glyph=&#xF71A;}"
                                                            Click="{x:Bind ViewModel.ResumeVolume}" />
                                        </MenuFlyout>
                                    </DropDownButton.Flyout>
                                </DropDownButton>

                                <Button x:Uid="AddKeyProtectorButton"
                                        VerticalAlignment="Center"
                                        IsEnabled="{x:Bind ViewModel.BitLockerUiEnabled, Mode=OneWay}"
                                        Click="{x:Bind ViewModel.AddKeyProtector}">
                                    <Button.ContentTemplate>
                                        <DataTemplate x:DataType="x:String">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon Glyph="&#xE710;" FontSize="16"/>
                                                <TextBlock Text="{x:Bind}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>

                                <Button x:Uid="ExportToJsonButton"
                                        x:Name="ExportToJsonButton"
                                        VerticalAlignment="Center"
                                        IsEnabled="{x:Bind ViewModel.BitLockerUiEnabled, Mode=OneWay}"
                                        Click="{x:Bind ViewModel.ExportBitLockerData}">
                                    <Button.ContentTemplate>
                                        <DataTemplate x:DataType="x:String">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                                                <TextBlock Text="{x:Bind}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>

                                <Button x:Uid="ClearDataButton"
                                        VerticalAlignment="Center"
                                        IsEnabled="{x:Bind ViewModel.BitLockerUiEnabled, Mode=OneWay}"
                                        Click="{x:Bind ViewModel.ClearBitLockerVolumes}">
                                    <Button.ContentTemplate>
                                        <DataTemplate x:DataType="x:String">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon Glyph="&#xE74D;" FontSize="16"/>
                                                <TextBlock Text="{x:Bind}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>

                                <TextBox x:Uid="SearchBoxTextBox"
                                         VerticalAlignment="Center"
                                         IsEnabled="{x:Bind ViewModel.BitLockerUiEnabled, Mode=OneWay}"
                                         Text="{x:Bind ViewModel.BitLockerSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                                <!-- Total chip -->
                                <Border CornerRadius="8"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Center"
                                        Padding="10,6"
                                        BorderThickness="1"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                                    <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                                        <FontIcon Glyph="&#xE8A9;" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" />
                                        <TextBlock VerticalAlignment="Center">
                                            <Run x:Uid="TotalText" />
                                            <Run Text="{x:Bind ViewModel.BitLockerVolumes.Count, Mode=OneWay}" FontWeight="SemiBold" />
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                            </controls:WrapPanel>
                        </Border>

                        <SplitView Grid.Row="1"
                                   x:Name="BitLockerSplitView"
                                   DisplayMode="Overlay"
                                   IsPaneOpen="{x:Bind ViewModel.IsBitLockerDetailsPaneOpen, Mode=TwoWay}"
                                   OpenPaneLength="480"
                                   CompactPaneLength="0"
                                   PanePlacement="Right">

                            <!-- List of volumes -->
                            <SplitView.Content>
                                <customUI:ListViewV2
                                             RegistryKey="BitLockerVolumes"
                                             IsEnabled="{x:Bind ViewModel.BitLockerUiEnabled, Mode=OneWay}"
                                             ItemsSource="{x:Bind ViewModel.BitLockerVolumes}"
                                             SelectionMode="Single"
                                             SelectedItem="{x:Bind ViewModel.SelectedBitLockerVolume, Mode=TwoWay}"
                                             IsItemClickEnabled="True"
                                             ItemClick="{x:Bind ViewModel.BitLockerVolumesList_ItemClick}">

                                    <customUI:ListViewV2.Header>
                                        <Border CornerRadius="5" Background="Black" customUI:StickyHeaderBehaviorV2.IsEnabled="True">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="{x:Bind ViewModel.BLColWidth1, Mode=TwoWay}" MinWidth="50"/>
                                                    <ColumnDefinition Width="{x:Bind ViewModel.BLColWidth2, Mode=TwoWay}" MinWidth="50"/>
                                                    <ColumnDefinition Width="{x:Bind ViewModel.BLColWidth3, Mode=TwoWay}" MinWidth="50"/>
                                                    <ColumnDefinition Width="{x:Bind ViewModel.BLColWidth4, Mode=TwoWay}" MinWidth="50"/>
                                                    <ColumnDefinition Width="{x:Bind ViewModel.BLColWidth5, Mode=TwoWay}" MinWidth="50"/>
                                                    <ColumnDefinition Width="{x:Bind ViewModel.BLColWidth6, Mode=TwoWay}" MinWidth="50"/>
                                                    <ColumnDefinition Width="{x:Bind ViewModel.BLColWidth7, Mode=TwoWay}" MinWidth="50"/>
                                                    <ColumnDefinition Width="{x:Bind ViewModel.BLColWidth8, Mode=TwoWay}" MinWidth="50"/>
                                                    <ColumnDefinition Width="{x:Bind ViewModel.BLColWidth9, Mode=TwoWay}" MinWidth="50"/>
                                                    <ColumnDefinition Width="{x:Bind ViewModel.BLColWidth10, Mode=TwoWay}" MinWidth="50"/>
                                                    <ColumnDefinition Width="{x:Bind ViewModel.BLColWidth11, Mode=TwoWay}" MinWidth="50"/>
                                                    <ColumnDefinition Width="{x:Bind ViewModel.BLColWidth12, Mode=TwoWay}" MinWidth="50"/>
                                                </Grid.ColumnDefinitions>

                                                <Button x:Uid="MountPointColumnHeaderBtn" Tag="MountPoint" Grid.Column="0" Margin="10,0,0,0" Style="{StaticResource ListViewHeaderButton}" Click="{x:Bind ViewModel.HeaderColumnSortingButton_Click}"/>
                                                <Button x:Uid="ProtectionStatusColumnHeaderBtn" Tag="ProtectionStatus" Grid.Column="1" Style="{StaticResource ListViewHeaderButton}" Click="{x:Bind ViewModel.HeaderColumnSortingButton_Click}"/>
                                                <Button x:Uid="ConversionStatusColumnHeaderBtn" Tag="ConversionStatus" Grid.Column="2" Style="{StaticResource ListViewHeaderButton}" Click="{x:Bind ViewModel.HeaderColumnSortingButton_Click}"/>
                                                <Button x:Uid="EncryptionMethodColumnHeaderBtn" Tag="EncryptionMethod" Grid.Column="3" Style="{StaticResource ListViewHeaderButton}" Click="{x:Bind ViewModel.HeaderColumnSortingButton_Click}"/>
                                                <Button x:Uid="EncryptionPercentageColumnHeaderBtn" Tag="EncryptionPercentage" Grid.Column="4" Style="{StaticResource ListViewHeaderButton}" Click="{x:Bind ViewModel.HeaderColumnSortingButton_Click}"/>
                                                <Button x:Uid="WipePercentageColumnHeaderBtn" Tag="WipePercentage" Grid.Column="5" Style="{StaticResource ListViewHeaderButton}" Click="{x:Bind ViewModel.HeaderColumnSortingButton_Click}"/>
                                                <Button x:Uid="AutoUnlockEnabledColumnHeaderBtn" Tag="AutoUnlockEnabled" Grid.Column="6" Style="{StaticResource ListViewHeaderButton}" Click="{x:Bind ViewModel.HeaderColumnSortingButton_Click}"/>
                                                <Button x:Uid="AutoUnlockKeyStoredColumnHeaderBtn" Tag="AutoUnlockKeyStored" Grid.Column="7" Style="{StaticResource ListViewHeaderButton}" Click="{x:Bind ViewModel.HeaderColumnSortingButton_Click}"/>
                                                <Button x:Uid="VolumeTypeColumnHeaderBtn" Tag="VolumeType" Grid.Column="8" Style="{StaticResource ListViewHeaderButton}" Click="{x:Bind ViewModel.HeaderColumnSortingButton_Click}"/>
                                                <Button x:Uid="CapacityGBColumnHeaderBtn" Tag="CapacityGB" Grid.Column="9" Style="{StaticResource ListViewHeaderButton}" Click="{x:Bind ViewModel.HeaderColumnSortingButton_Click}"/>
                                                <Button x:Uid="FileSystemTypeColumnHeaderBtn" Tag="FileSystemType" Grid.Column="10" Style="{StaticResource ListViewHeaderButton}" Click="{x:Bind ViewModel.HeaderColumnSortingButton_Click}"/>
                                                <Button x:Uid="FriendlyNameColumnHeaderBtn" Tag="FriendlyName" Grid.Column="11" Style="{StaticResource ListViewHeaderButton}" Click="{x:Bind ViewModel.HeaderColumnSortingButton_Click}"/>

                                                <controls:GridSplitter Grid.Column="1"/>
                                                <controls:GridSplitter Grid.Column="2"/>
                                                <controls:GridSplitter Grid.Column="3"/>
                                                <controls:GridSplitter Grid.Column="4"/>
                                                <controls:GridSplitter Grid.Column="5"/>
                                                <controls:GridSplitter Grid.Column="6"/>
                                                <controls:GridSplitter Grid.Column="7"/>
                                                <controls:GridSplitter Grid.Column="8"/>
                                                <controls:GridSplitter Grid.Column="9"/>
                                                <controls:GridSplitter Grid.Column="10"/>
                                                <controls:GridSplitter Grid.Column="11"/>
                                            </Grid>
                                        </Border>
                                    </customUI:ListViewV2.Header>

                                    <customUI:ListViewV2.ItemTemplate>
                                        <DataTemplate x:DataType="bitLocker:BitLockerVolume" xmlns:VMs="using:HardenSystemSecurity.ViewModels">
                                            <Grid Background="Transparent">
                                                <Grid.ContextFlyout>
                                                    <MenuFlyout>
                                                        <MenuFlyoutItem x:Uid="CopyRow"
                                                                        Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopySelectedVolumes_Click}" >
                                                            <MenuFlyoutItem.Icon>
                                                                <FontIcon Glyph="&#xE8C8;"/>
                                                            </MenuFlyoutItem.Icon>
                                                        </MenuFlyoutItem>

                                                        <MenuFlyoutSubItem x:Uid="CopyIndividualItems">
                                                            <MenuFlyoutSubItem.Icon>
                                                                <FontIcon Glyph="&#xE8C8;"/>
                                                            </MenuFlyoutSubItem.Icon>
                                                            <MenuFlyoutSubItem.Items>
                                                                <MenuFlyoutItem x:Uid="MountPointHeader" Tag="MountPoint" Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyVolumeProperty_Click}"/>
                                                                <MenuFlyoutItem x:Uid="ProtectionStatusHeader" Tag="ProtectionStatus" Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyVolumeProperty_Click}"/>
                                                                <MenuFlyoutItem x:Uid="ConversionStatusHeader" Tag="ConversionStatus" Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyVolumeProperty_Click}"/>
                                                                <MenuFlyoutItem x:Uid="EncryptionMethodHeader" Tag="EncryptionMethod" Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyVolumeProperty_Click}"/>
                                                                <MenuFlyoutItem x:Uid="EncryptionPercentageHeader" Tag="EncryptionPercentage" Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyVolumeProperty_Click}"/>
                                                                <MenuFlyoutItem x:Uid="WipePercentageHeader" Tag="WipePercentage" Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyVolumeProperty_Click}"/>
                                                                <MenuFlyoutItem x:Uid="AutoUnlockEnabledHeader" Tag="AutoUnlockEnabled" Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyVolumeProperty_Click}"/>
                                                                <MenuFlyoutItem x:Uid="AutoUnlockKeyStoredHeader" Tag="AutoUnlockKeyStored" Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyVolumeProperty_Click}"/>
                                                                <MenuFlyoutItem x:Uid="VolumeTypeHeader" Tag="VolumeType" Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyVolumeProperty_Click}"/>
                                                                <MenuFlyoutItem x:Uid="CapacityGBHeader" Tag="CapacityGB" Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyVolumeProperty_Click}"/>
                                                                <MenuFlyoutItem x:Uid="FileSystemTypeHeader" Tag="FileSystemType" Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyVolumeProperty_Click}"/>
                                                                <MenuFlyoutItem x:Uid="FriendlyNameHeader" Tag="FriendlyName" Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyVolumeProperty_Click}"/>
                                                            </MenuFlyoutSubItem.Items>
                                                        </MenuFlyoutSubItem>
                                                    </MenuFlyout>
                                                </Grid.ContextFlyout>

                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="{x:Bind VMs:ViewModelProvider.BitLockerVM.BLColWidth1, Mode=OneWay}"/>
                                                    <ColumnDefinition Width="{x:Bind VMs:ViewModelProvider.BitLockerVM.BLColWidth2, Mode=OneWay}"/>
                                                    <ColumnDefinition Width="{x:Bind VMs:ViewModelProvider.BitLockerVM.BLColWidth3, Mode=OneWay}"/>
                                                    <ColumnDefinition Width="{x:Bind VMs:ViewModelProvider.BitLockerVM.BLColWidth4, Mode=OneWay}"/>
                                                    <ColumnDefinition Width="{x:Bind VMs:ViewModelProvider.BitLockerVM.BLColWidth5, Mode=OneWay}"/>
                                                    <ColumnDefinition Width="{x:Bind VMs:ViewModelProvider.BitLockerVM.BLColWidth6, Mode=OneWay}"/>
                                                    <ColumnDefinition Width="{x:Bind VMs:ViewModelProvider.BitLockerVM.BLColWidth7, Mode=OneWay}"/>
                                                    <ColumnDefinition Width="{x:Bind VMs:ViewModelProvider.BitLockerVM.BLColWidth8, Mode=OneWay}"/>
                                                    <ColumnDefinition Width="{x:Bind VMs:ViewModelProvider.BitLockerVM.BLColWidth9, Mode=OneWay}"/>
                                                    <ColumnDefinition Width="{x:Bind VMs:ViewModelProvider.BitLockerVM.BLColWidth10, Mode=OneWay}"/>
                                                    <ColumnDefinition Width="{x:Bind VMs:ViewModelProvider.BitLockerVM.BLColWidth11, Mode=OneWay}"/>
                                                    <ColumnDefinition Width="{x:Bind VMs:ViewModelProvider.BitLockerVM.BLColWidth12, Mode=OneWay}"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Text="{x:Bind MountPoint}"            Style="{StaticResource ListViewCellTextBlock}" Grid.Column="0"/>
                                                <TextBlock Text="{x:Bind ProtectionStatus}"      Style="{StaticResource ListViewCellTextBlock}" Grid.Column="1"/>
                                                <TextBlock Text="{x:Bind ConversionStatus}"      Style="{StaticResource ListViewCellTextBlock}" Grid.Column="2"/>
                                                <TextBlock Text="{x:Bind EncryptionMethod}"      Style="{StaticResource ListViewCellTextBlock}" Grid.Column="3"/>
                                                <TextBlock Text="{x:Bind EncryptionPercentage}"  Style="{StaticResource ListViewCellTextBlock}" Grid.Column="4"/>
                                                <TextBlock Text="{x:Bind WipePercentage}"        Style="{StaticResource ListViewCellTextBlock}" Grid.Column="5"/>
                                                <TextBlock Text="{x:Bind AutoUnlockEnabled}"     Style="{StaticResource ListViewCellTextBlock}" Grid.Column="6"/>
                                                <TextBlock Text="{x:Bind AutoUnlockKeyStored}"   Style="{StaticResource ListViewCellTextBlock}" Grid.Column="7"/>
                                                <TextBlock Text="{x:Bind VolumeType}"            Style="{StaticResource ListViewCellTextBlock}" Grid.Column="8"/>
                                                <TextBlock Text="{x:Bind CapacityGB}"            Style="{StaticResource ListViewCellTextBlock}" Grid.Column="9"/>
                                                <TextBlock Text="{x:Bind FileSystemType}"        Style="{StaticResource ListViewCellTextBlock}" Grid.Column="10"/>
                                                <TextBlock Text="{x:Bind FriendlyName}"          Style="{StaticResource ListViewCellTextBlock}" Grid.Column="11"/>
                                            </Grid>
                                        </DataTemplate>
                                    </customUI:ListViewV2.ItemTemplate>
                                </customUI:ListViewV2>
                            </SplitView.Content>

                            <SplitView.Pane>

                                <Grid>
                                    <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="12" RowSpacing="8">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>

                                        <StackPanel Orientation="Horizontal"
                                                    HorizontalAlignment="Left"
                                                    Spacing="8"
                                                    Grid.Row="0">
                                            <TextBlock x:Uid="KeyProtectorsForMsg" Style="{StaticResource SubtitleTextBlockStyle}" />
                                            <TextBlock Text="{x:Bind ViewModel.SelectedBitLockerVolume.MountPoint, Mode=OneWay}" Style="{StaticResource SubtitleTextBlockStyle}" />
                                        </StackPanel>

                                        <Button x:Uid="CloseButton"
                                                Grid.Row="0"
                                                HorizontalAlignment="Right"
                                                Click="{x:Bind ViewModel.CloseBitLockerDetailsPane}">
                                            <Button.ContentTemplate>
                                                <DataTemplate x:DataType="x:String">
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <FontIcon Glyph="&#xE711;" FontSize="16"/>
                                                        <TextBlock Text="{x:Bind}"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </Button.ContentTemplate>
                                        </Button>

                                        <TextBlock Grid.Row="1"
                                                   Text="{x:Bind ViewModel.SelectedBitLockerVolume.FriendlyName, Mode=OneWay}"
                                                   FontStyle="Italic"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                                        <ScrollViewer Grid.Row="2">
                                            <StackPanel Spacing="12" Margin="0,0,10,0">
                                                <!-- Visible ONLY when no selection -->
                                                <TextBlock x:Uid="SelectVolumeFirstToSeeKeyProtectorsMsg"
                                                           Visibility="{x:Bind ViewModel.NoSelectionVisibility, Mode=OneWay}"
                                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                                                <!-- Visible ONLY when selection has zero key protectors -->
                                                <TextBlock x:Uid="NoKeyProtectorsFoundMsg"
                                                           Visibility="{x:Bind ViewModel.NoProtectorsVisibility, Mode=OneWay}"
                                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                                                <!-- Visible ONLY when there are protectors -->
                                                <ItemsControl ItemsSource="{x:Bind ViewModel.SelectedBitLockerVolume.KeyProtectors, Mode=OneWay}"
                                                              Visibility="{x:Bind ViewModel.HasProtectorsVisibility, Mode=OneWay}">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate x:DataType="bitLocker:KeyProtector" xmlns:VMs="using:HardenSystemSecurity.ViewModels">
                                                            <Border Padding="14"
                                                                    Margin="0,0,0,18"
                                                                    CornerRadius="10"
                                                                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                                                    BorderBrush="{StaticResource KeyProtectorBorderBrush}"
                                                                    BorderThickness="1.5">

                                                                <Grid RowSpacing="10">
                                                                    <Grid.RowDefinitions>
                                                                        <RowDefinition Height="Auto"/>
                                                                        <RowDefinition Height="*"/>
                                                                    </Grid.RowDefinitions>

                                                                    <controls:WrapPanel Orientation="Horizontal"
                                                                                        VerticalSpacing="10"
                                                                                        HorizontalSpacing="10"
                                                                                        Grid.Row="0"
                                                                                        HorizontalAlignment="Center">

                                                                        <!-- Copy button -->
                                                                        <Button Style="{StaticResource AccentButtonStyle}"
                                                                                x:Uid="CopyButton"
                                                                                MinWidth="0"
                                                                                Padding="10,6"
                                                                                Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.CopyKeyProtector_Click}">
                                                                            <Button.ContentTemplate>
                                                                                <DataTemplate x:DataType="x:String">
                                                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                                                        <FontIcon Glyph="&#xE8C8;" FontSize="16"/>
                                                                                        <TextBlock Text="{x:Bind}"/>
                                                                                    </StackPanel>
                                                                                </DataTemplate>
                                                                            </Button.ContentTemplate>
                                                                        </Button>

                                                                        <!-- Delete button -->
                                                                        <Button Style="{StaticResource AccentButtonStyle}"
                                                                                IsEnabled="{x:Bind VMs:ViewModelProvider.BitLockerVM.ElementsAreEnabled, Mode=OneWay}"
                                                                                Click="{x:Bind VMs:ViewModelProvider.BitLockerVM.RemoveKeyProtector_Click}"
                                                                                x:Uid="DeleteBLKeyProtectorButton"
                                                                                MinWidth="0"
                                                                                Padding="10,6">
                                                                            <Button.ContentTemplate>
                                                                                <DataTemplate x:DataType="x:String">
                                                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                                                        <FontIcon Glyph="&#xE74D;" FontSize="16"/>
                                                                                        <TextBlock Text="{x:Bind}"/>
                                                                                    </StackPanel>
                                                                                </DataTemplate>
                                                                            </Button.ContentTemplate>
                                                                        </Button>

                                                                    </controls:WrapPanel>

                                                                    <StackPanel Grid.Row="1" Spacing="10">

                                                                        <StackPanel.Resources>
                                                                            <Style x:Key="FieldRowGridStyle" TargetType="Grid">
                                                                                <Setter Property="ColumnSpacing" Value="12"/>
                                                                                <Setter Property="RowSpacing" Value="0"/>
                                                                                <Setter Property="Margin" Value="0"/>
                                                                            </Style>
                                                                            <Style x:Key="FieldLabelStyle" TargetType="TextBlock" BasedOn="{StaticResource BodyTextBlockStyle}">
                                                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                                                                <Setter Property="Foreground" Value="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                                                <Setter Property="VerticalAlignment" Value="Center"/>
                                                                                <Setter Property="Margin" Value="0"/>
                                                                            </Style>
                                                                            <Style x:Key="FieldValueStyle" TargetType="TextBlock" BasedOn="{StaticResource BodyTextBlockStyle}">
                                                                                <Setter Property="TextWrapping" Value="Wrap"/>
                                                                                <Setter Property="IsTextSelectionEnabled" Value="True"/>
                                                                                <Setter Property="VerticalAlignment" Value="Center"/>
                                                                                <Setter Property="Margin" Value="0"/>
                                                                            </Style>
                                                                            <Style x:Key="FieldIconStyle" TargetType="FontIcon">
                                                                                <Setter Property="FontSize" Value="14"/>
                                                                                <Setter Property="Foreground" Value="{ThemeResource AccentFillColorDefaultBrush}"/>
                                                                                <Setter Property="VerticalAlignment" Value="Center"/>
                                                                            </Style>
                                                                        </StackPanel.Resources>

                                                                        <!-- TYPE -->
                                                                        <Grid Style="{StaticResource FieldRowGridStyle}">
                                                                            <Grid.ColumnDefinitions>
                                                                                <ColumnDefinition Width="20"/>
                                                                                <ColumnDefinition Width="Auto"/>
                                                                                <ColumnDefinition Width="*"/>
                                                                            </Grid.ColumnDefinitions>
                                                                            <FontIcon Grid.Column="0" Glyph="&#xE8CB;" Style="{StaticResource FieldIconStyle}"/>
                                                                            <TextBlock Grid.Column="1" x:Uid="Type" Style="{StaticResource FieldLabelStyle}"/>
                                                                            <TextBlock Grid.Column="2" Text="{x:Bind Type}" Style="{StaticResource FieldValueStyle}"/>
                                                                        </Grid>

                                                                        <!-- ID -->
                                                                        <Grid Style="{StaticResource FieldRowGridStyle}">
                                                                            <Grid.ColumnDefinitions>
                                                                                <ColumnDefinition Width="20"/>
                                                                                <ColumnDefinition Width="Auto"/>
                                                                                <ColumnDefinition Width="*"/>
                                                                            </Grid.ColumnDefinitions>
                                                                            <FontIcon Grid.Column="0" Glyph="&#xE946;" Style="{StaticResource FieldIconStyle}"/>
                                                                            <TextBlock Grid.Column="1" x:Uid="ID" Style="{StaticResource FieldLabelStyle}"/>
                                                                            <TextBlock Grid.Column="2" Text="{x:Bind ID}" Style="{StaticResource FieldValueStyle}" FontFamily="Consolas"/>
                                                                        </Grid>

                                                                        <!-- AUTO UNLOCK -->
                                                                        <Grid Style="{StaticResource FieldRowGridStyle}">
                                                                            <Grid.ColumnDefinitions>
                                                                                <ColumnDefinition Width="20"/>
                                                                                <ColumnDefinition Width="Auto"/>
                                                                                <ColumnDefinition Width="*"/>
                                                                            </Grid.ColumnDefinitions>
                                                                            <FontIcon Grid.Column="0" Glyph="&#xE72E;" Style="{StaticResource FieldIconStyle}"/>
                                                                            <TextBlock Grid.Column="1" x:Uid="AutoUnlock" Style="{StaticResource FieldLabelStyle}"/>
                                                                            <TextBlock Grid.Column="2" Text="{x:Bind AutoUnlockProtector}" Style="{StaticResource FieldValueStyle}"/>
                                                                        </Grid>

                                                                        <!-- KEY FILE NAME -->
                                                                        <Grid Style="{StaticResource FieldRowGridStyle}">
                                                                            <Grid.ColumnDefinitions>
                                                                                <ColumnDefinition Width="20"/>
                                                                                <ColumnDefinition Width="Auto"/>
                                                                                <ColumnDefinition Width="*"/>
                                                                            </Grid.ColumnDefinitions>
                                                                            <FontIcon Grid.Column="0" Glyph="&#xE8A5;" Style="{StaticResource FieldIconStyle}"/>
                                                                            <TextBlock Grid.Column="1" x:Uid="FileName" Style="{StaticResource FieldLabelStyle}"/>
                                                                            <TextBlock Grid.Column="2" Text="{x:Bind KeyFileName}" Style="{StaticResource FieldValueStyle}" FontFamily="Consolas"/>
                                                                        </Grid>

                                                                        <!-- RECOVERY PASSWORD -->
                                                                        <Grid Style="{StaticResource FieldRowGridStyle}">
                                                                            <Grid.ColumnDefinitions>
                                                                                <ColumnDefinition Width="20"/>
                                                                                <ColumnDefinition Width="Auto"/>
                                                                                <ColumnDefinition Width="*"/>
                                                                            </Grid.ColumnDefinitions>
                                                                            <FontIcon Grid.Column="0" Glyph="&#xE192;" Style="{StaticResource FieldIconStyle}"/>
                                                                            <TextBlock Grid.Column="1" x:Uid="RecoveryPassword" Style="{StaticResource FieldLabelStyle}"/>
                                                                            <TextBlock Grid.Column="2" Text="{x:Bind RecoveryPassword}" Style="{StaticResource FieldValueStyle}" FontFamily="Consolas"/>
                                                                        </Grid>

                                                                        <!-- CERTIFICATE TYPE -->
                                                                        <Grid Style="{StaticResource FieldRowGridStyle}">
                                                                            <Grid.ColumnDefinitions>
                                                                                <ColumnDefinition Width="20"/>
                                                                                <ColumnDefinition Width="Auto"/>
                                                                                <ColumnDefinition Width="*"/>
                                                                            </Grid.ColumnDefinitions>
                                                                            <FontIcon Grid.Column="0" Glyph="&#xEB95;" Style="{StaticResource FieldIconStyle}"/>
                                                                            <TextBlock Grid.Column="1" x:Uid="CertificateType" Style="{StaticResource FieldLabelStyle}"/>
                                                                            <TextBlock Grid.Column="2" Text="{x:Bind KeyCertificateType}" Style="{StaticResource FieldValueStyle}"/>
                                                                        </Grid>

                                                                        <!-- THUMBPRINT -->
                                                                        <Grid Style="{StaticResource FieldRowGridStyle}">
                                                                            <Grid.ColumnDefinitions>
                                                                                <ColumnDefinition Width="20"/>
                                                                                <ColumnDefinition Width="Auto"/>
                                                                                <ColumnDefinition Width="*"/>
                                                                            </Grid.ColumnDefinitions>
                                                                            <FontIcon Grid.Column="0" Glyph="&#xE7B5;" Style="{StaticResource FieldIconStyle}"/>
                                                                            <TextBlock Grid.Column="1" x:Uid="Thumbprint" Style="{StaticResource FieldLabelStyle}"/>
                                                                            <TextBlock Grid.Column="2" Text="{x:Bind Thumbprint}" Style="{StaticResource FieldValueStyle}" FontFamily="Consolas"/>
                                                                        </Grid>
                                                                    </StackPanel>
                                                                </Grid>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </StackPanel>
                                        </ScrollViewer>
                                    </Grid>

                                    <!-- Overlay PropertySizer (invisible) to provide drag behavior without a visible color strip -->
                                    <controls:PropertySizer
                                        Width="8"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Stretch"
                                        Binding="{x:Bind BitLockerSplitView.OpenPaneLength, Mode=TwoWay}"
                                        Orientation="Vertical"
                                        IsDragInverted="True"
                                        IsThumbVisible="False"
                                        Background="Transparent"
                                        Cursor="SizeWestEast"
                                        Minimum="400"
                                        Maximum="1200"
                                        IsTabStop="False"
                                        Margin="0"/>
                                </Grid>
                            </SplitView.Pane>
                        </SplitView>
                    </Grid>
                </TabViewItem.Content>
            </TabViewItem>
        </TabView>
    </Grid>
</Page>
