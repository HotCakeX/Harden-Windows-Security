<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="AppControlManager.Pages.DeploymentPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:AppControlManager.Pages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:win="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:behaviors="using:CommunityToolkit.WinUI.Behaviors"
    xmlns:MSGraph="using:AppControlManager.MicrosoftGraph"
    xmlns:customUI="using:AppControlManager.CustomUIElements"
    xmlns:animations="using:CommunityToolkit.WinUI.Animations"
    xmlns:animatedvisuals="using:AnimatedVisuals"
    xmlns:labs="using:CommunityToolkit.Labs.WinUI"
    FlowDirection="{x:Bind AppSettings.ApplicationGlobalFlowDirection, Mode=OneWay}"
    mc:Ignorable="d">

    <ScrollViewer>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <controls:WrapPanel Grid.Row="0" VerticalSpacing="4" HorizontalSpacing="4" Orientation="Vertical" Margin="6,0,6,10">

                <TextBlock x:Uid="DeploymentPageTitle" TextWrapping="WrapWholeWords" Style="{StaticResource BodyTextBlockStyle}" />

                <HyperlinkButton x:Uid="GuideButtonAtTop" NavigateUri="https://github.com/HotCakeX/Harden-Windows-Security/wiki/Deploy-App-Control-Policy" />

            </controls:WrapPanel>

            <customUI:InfoBarV2 Grid.Row="1"
                                IsOpen="{x:Bind ViewModel.MainInfoBarIsOpen, Mode=TwoWay}"
                                Message="{x:Bind ViewModel.MainInfoBarMessage, Mode=OneWay}"
                                Severity="{x:Bind ViewModel.MainInfoBarSeverity, Mode=OneWay}"
                                IsClosable="{x:Bind ViewModel.MainInfoBarIsClosable, Mode=OneWay}">
                <customUI:InfoBarV2.Content>
                    <ProgressBar Margin="0,0,0,15"
                                 Visibility="{x:Bind ViewModel.MainProgressBarVisibility, Mode=OneWay}"
                                 Value="0"
                                 IsIndeterminate="True"
                                 Minimum="0"
                                 Maximum="100"/>
                </customUI:InfoBarV2.Content>
            </customUI:InfoBarV2>

            <StackPanel HorizontalAlignment="Stretch"
                        Spacing="{StaticResource SettingsCardSpacing}"
                        Grid.Row="2">

                <win:StackPanel.ChildrenTransitions>
                    <win:EntranceThemeTransition FromVerticalOffset="50" />
                    <win:RepositionThemeTransition IsStaggeringEnabled="False" />
                </win:StackPanel.ChildrenTransitions>

                <controls:SettingsExpander x:Uid="UseIntuneDeploySettingsExpander"
                                           IsExpanded="True"
                                           HeaderIcon="{ui:FontIcon Glyph=&#xEA91;}">

                    <TextBlock Text="{x:Bind ViewModel.LocalOnlineStatusText, Mode=OneWay}"
                               TextWrapping="Wrap" />

                    <controls:SettingsExpander.Items>

                        <customUI:SettingsCardV2 x:Uid="EntraSignInSettingsCard"
                                                 HeaderIcon="{ui:FontIcon Glyph=&#xEC27;}">

                            <Button BorderThickness="0.8" x:Uid="MicrosoftGraphButton">

                                <Button.Resources>
                                    <!-- https://github.com/microsoft/microsoft-ui-xaml/blob/main/src/controls/dev/CommonStyles/Button_themeresources.xaml#L13-L16 -->
                                    <ResourceDictionary>
                                        <LinearGradientBrush x:Key="ButtonBorderBrush" StartPoint="0,0" EndPoint="1,0">
                                            <GradientStop Color="HotPink" Offset="0.0"/>
                                            <GradientStop Color="#D1C4E9" Offset="0.3"/>
                                            <GradientStop Color="#BBDEFB" Offset="0.6"/>
                                            <GradientStop Color="MediumPurple" Offset="1.0"/>
                                        </LinearGradientBrush>

                                        <LinearGradientBrush x:Key="ButtonBorderBrushPointerOver" StartPoint="0,0" EndPoint="1,0">
                                            <GradientStop Color="HotPink" Offset="0.0"/>
                                            <GradientStop Color="#D1C4E9" Offset="0.3"/>
                                            <GradientStop Color="#BBDEFB" Offset="0.6"/>
                                            <GradientStop Color="MediumPurple" Offset="1.0"/>
                                        </LinearGradientBrush>

                                        <LinearGradientBrush x:Key="ButtonBorderBrushPressed" StartPoint="0,0" EndPoint="1,0">
                                            <GradientStop Color="HotPink" Offset="0.0"/>
                                            <GradientStop Color="#D1C4E9" Offset="0.3"/>
                                            <GradientStop Color="#BBDEFB" Offset="0.6"/>
                                            <GradientStop Color="MediumPurple" Offset="1.0"/>
                                        </LinearGradientBrush>
                                    </ResourceDictionary>
                                </Button.Resources>

                                <Button.Content>
                                    <StackPanel Orientation="Horizontal">
                                        <AnimatedIcon Height="25" Width="25" Margin="-5,-5,0,-5">
                                            <AnimatedIcon.Source>
                                                <animatedvisuals:MicrosoftCloud/>
                                            </AnimatedIcon.Source>
                                        </AnimatedIcon>
                                        <TextBlock Text="Microsoft Graph" Margin="5,0,0,0" />
                                    </StackPanel>
                                </Button.Content>
                                <Button.Flyout>
                                    <Flyout Placement="Bottom">

                                        <Flyout.FlyoutPresenterStyle>
                                            <Style TargetType="FlyoutPresenter">

                                                <Setter Property="Padding" Value="5,5,5,0"/>

                                                <!-- Same corner radius as the one in PanelStyle  -->
                                                <Setter Property="CornerRadius" Value="8" />

                                                <!--
                                                    Important: the "resolution order" for widths (at least in winui) is minwidth, maxwidth, width
                                                    Width does not override MaxWidth
                                                    https://learn.microsoft.com/uwp/api/windows.ui.xaml.frameworkelement.maxwidth?view=winrt-26100#remarks
                                                    -->
                                                <Setter Property="MaxWidth" Value="1234" />
                                            </Style>
                                        </Flyout.FlyoutPresenterStyle>

                                        <StackPanel Width="500"
                                                VerticalAlignment="Top"
                                                Orientation="Vertical"
                                                Spacing="8">

                                            <controls:Segmented x:Name="segmentedControl"
                                                    HorizontalAlignment="Stretch"
                                                    SelectedIndex="0">
                                                <controls:SegmentedItem Content="Active Account"
                                                        Tag="Active">
                                                    <controls:SegmentedItem.Icon>
                                                        <IconSourceElement>
                                                            <BitmapIconSource UriSource="/Assets/External/Bottle.png" ShowAsMonochrome="False" />
                                                        </IconSourceElement>
                                                    </controls:SegmentedItem.Icon>

                                                </controls:SegmentedItem>

                                                <controls:SegmentedItem Content="Sign In"
                                                         Tag="Authentication" >
                                                    <controls:SegmentedItem.Icon>
                                                        <IconSourceElement>
                                                            <BitmapIconSource UriSource="/Assets/External/Authentication.png" ShowAsMonochrome="False" />
                                                        </IconSourceElement>
                                                    </controls:SegmentedItem.Icon>
                                                </controls:SegmentedItem>

                                                <controls:SegmentedItem Content="Signed In Accounts"
                                                        Tag="SignedIn">
                                                    <controls:SegmentedItem.Icon>
                                                        <IconSourceElement>
                                                            <BitmapIconSource UriSource="/Assets/External/Vault.png" ShowAsMonochrome="False" />
                                                        </IconSourceElement>
                                                    </controls:SegmentedItem.Icon>
                                                </controls:SegmentedItem>
                                            </controls:Segmented>

                                            <controls:SwitchPresenter Value="{x:Bind ((controls:SegmentedItem)segmentedControl.SelectedItem).Tag, Mode=OneWay}" HorizontalAlignment="Center" VerticalAlignment="Center">

                                                <controls:Case Value="Active">
                                                    <StackPanel animations:Implicit.HideAnimations="{StaticResource HideTransitions}"
                                                            animations:Implicit.ShowAnimations="{StaticResource ShowTransitions}"
                                                            Style="{StaticResource PanelStyle}" HorizontalAlignment="Center" VerticalAlignment="Center" Orientation="Horizontal" Spacing="10" Padding="10">

                                                        <controls:WrapPanel Orientation="Vertical" VerticalSpacing="5" HorizontalSpacing="10" HorizontalAlignment="Center">

                                                            <TextBlock Text="Details of the account that's currently in use" Margin="0,0,0,5" HorizontalAlignment="Center"/>

                                                            <TextBox IsReadOnly="True" x:Uid="CurrentActiveAccountUsername" Text="{x:Bind ViewModel.AuthCompanionCLS.CurrentActiveAccountUsername, Mode=OneWay}" HorizontalAlignment="Center" Width="470"/>
                                                            <TextBox IsReadOnly="True" x:Uid="CurrentActiveAccountTenantID" Text="{x:Bind ViewModel.AuthCompanionCLS.CurrentActiveAccountTenantID, Mode=OneWay}" Margin="0,8,0,0" HorizontalAlignment="Center" Width="470"/>
                                                            <TextBox IsReadOnly="True" x:Uid="CurrentActiveAccountAccountIdentifier" Text="{x:Bind ViewModel.AuthCompanionCLS.CurrentActiveAccountAccountIdentifier, Mode=OneWay}" Margin="0,8,0,0" HorizontalAlignment="Center" Width="470"/>
                                                            <TextBox IsReadOnly="True" x:Uid="CurrentActiveAccountPermissions" Text="{x:Bind ViewModel.AuthCompanionCLS.CurrentActiveAccountPermissions, Mode=OneWay}" Margin="0,8,0,0" HorizontalAlignment="Center" Width="470"/>

                                                        </controls:WrapPanel>

                                                    </StackPanel>

                                                </controls:Case>

                                                <controls:Case Value="Authentication">
                                                    <StackPanel animations:Implicit.HideAnimations="{StaticResource HideTransitions}"
                                                        animations:Implicit.ShowAnimations="{StaticResource ShowTransitions}"
                                                        Style="{StaticResource PanelStyle}" HorizontalAlignment="Center" VerticalAlignment="Center" Orientation="Vertical" Spacing="10" Padding="10">

                                                        <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">

                                                            <Button IsEnabled="{x:Bind ViewModel.AuthCompanionCLS.SignInButtonState, Mode=OneWay}"
                                                                    x:Uid="SignInButton" Click="{x:Bind ViewModel.AuthCompanionCLS.SignIn}">
                                                                <Button.Content>
                                                                    <StackPanel Orientation="Horizontal">
                                                                        <AnimatedIcon Height="25" Width="25" Margin="-5,-5,0,-5">
                                                                            <AnimatedIcon.Source>
                                                                                <animatedvisuals:SignIn/>
                                                                            </AnimatedIcon.Source>
                                                                        </AnimatedIcon>
                                                                        <TextBlock Text="Sign In" Margin="5,0,0,0" />
                                                                    </StackPanel>
                                                                </Button.Content>
                                                            </Button>

                                                            <Button IsEnabled="{x:Bind ViewModel.AuthCompanionCLS.SignOutButtonState, Mode=OneWay}"
                                                                    x:Uid="CancelSigningInButton" Click="{x:Bind ViewModel.AuthCompanionCLS.MSGraphCancelSignInButton_Click}">
                                                                <Button.Content>
                                                                    <StackPanel Orientation="Horizontal">
                                                                        <AnimatedIcon Height="25" Width="25" Margin="-5,-5,0,-5">
                                                                            <AnimatedIcon.Source>
                                                                                <animatedvisuals:Cancel/>
                                                                            </AnimatedIcon.Source>
                                                                        </AnimatedIcon>
                                                                        <TextBlock Text="Cancel Signing In" Margin="5,0,0,0" />
                                                                    </StackPanel>
                                                                </Button.Content>
                                                            </Button>

                                                        </StackPanel>

                                                        <ComboBox
                                                                ItemsSource="{x:Bind ViewModel.AuthCompanionCLS.SignInMethodsComboBoxSource}"
                                                                Margin="0,5,0,0"
                                                                HorizontalAlignment="Center"
                                                                x:Uid="SignInMethodsComboBox"
                                                                SelectedItem="{x:Bind ViewModel.AuthCompanionCLS.SignInMethodsComboBoxSelectedItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                            <!-- To center the header text -->
                                                            <ComboBox.HeaderTemplate>
                                                                <DataTemplate>
                                                                    <TextBlock Text="{Binding}"
                                                                        HorizontalAlignment="Center"
                                                                        TextAlignment="Center" />
                                                                </DataTemplate>
                                                            </ComboBox.HeaderTemplate>
                                                        </ComboBox>

                                                        <ComboBox
                                                            ItemsSource="{x:Bind ViewModel.AuthCompanionCLS.AuthenticationContextComboBoxSource}"
                                                            Margin="0,5,0,0"
                                                            HorizontalAlignment="Center"
                                                            x:Uid="AuthenticationContextComboBox"
                                                            SelectedItem="{x:Bind ViewModel.AuthCompanionCLS.AuthenticationContextComboBoxSelectedItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                            <!-- To center the header text -->
                                                            <ComboBox.HeaderTemplate>
                                                                <DataTemplate>
                                                                    <TextBlock Text="{Binding}"
                                                                        HorizontalAlignment="Center"
                                                                        TextAlignment="Center" />
                                                                </DataTemplate>
                                                            </ComboBox.HeaderTemplate>
                                                        </ComboBox>

                                                    </StackPanel>
                                                </controls:Case>

                                                <controls:Case Value="SignedIn">


                                                    <StackPanel animations:Implicit.HideAnimations="{StaticResource HideTransitions}"
                                                            animations:Implicit.ShowAnimations="{StaticResource ShowTransitions}"
                                                            Style="{StaticResource PanelStyle}" HorizontalAlignment="Center" VerticalAlignment="Center" Orientation="Vertical" Spacing="5" Padding="3">

                                                        <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center" VerticalAlignment="Top">

                                                            <Button HorizontalAlignment="Center" x:Uid="RemoveAccountButton" VerticalAlignment="Top" Click="{x:Bind ViewModel.AuthCompanionCLS.LogOutOfSelectedAccount}">
                                                                <Button.Content>
                                                                    <StackPanel Orientation="Horizontal">
                                                                        <AnimatedIcon Height="25" Width="25" Margin="-5,-5,0,-5">
                                                                            <AnimatedIcon.Source>
                                                                                <animatedvisuals:Logout/>
                                                                            </AnimatedIcon.Source>
                                                                        </AnimatedIcon>
                                                                        <TextBlock Text="Remove" Margin="5,0,0,0" />
                                                                    </StackPanel>
                                                                </Button.Content>
                                                            </Button>


                                                            <Button HorizontalAlignment="Center" x:Uid="SetAccountAsActiveButton" VerticalAlignment="Top" Click="{x:Bind ViewModel.AuthCompanionCLS.SetActiveFromListView}">
                                                                <Button.Content>
                                                                    <StackPanel Orientation="Horizontal">
                                                                        <AnimatedIcon Height="25" Width="25" Margin="-5,-5,0,-5">
                                                                            <AnimatedIcon.Source>
                                                                                <animatedvisuals:Select/>
                                                                            </AnimatedIcon.Source>
                                                                        </AnimatedIcon>
                                                                        <TextBlock Text="Set as Active" Margin="5,0,0,0" />
                                                                    </StackPanel>
                                                                </Button.Content>
                                                            </Button>

                                                        </StackPanel>

                                                        <!-- Shimmer -->

                                                        <StackPanel Margin="0,10,0,0"
                                                            Visibility="{x:Bind ViewModel.AuthCompanionCLS.AuthenticatedAccountsShimmerVisibility, Mode=OneWay}"
                                                            Width="450"
                                                            Height="255"
                                                            Padding="16"
                                                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                            BorderThickness="1"
                                                            CornerRadius="4"
                                                            Spacing="12">

                                                            <Grid Width="400" Height="45" CornerRadius="7" HorizontalAlignment="Center">
                                                                <labs:Shimmer Visibility="{x:Bind ViewModel.AuthCompanionCLS.AuthenticatedAccountsShimmerVisibility, Mode=OneWay}" />
                                                            </Grid>

                                                            <Grid Width="400" Height="45" CornerRadius="7" HorizontalAlignment="Center">
                                                                <labs:Shimmer Visibility="{x:Bind ViewModel.AuthCompanionCLS.AuthenticatedAccountsShimmerVisibility, Mode=OneWay}" />
                                                            </Grid>

                                                            <Grid Width="400" Height="45" CornerRadius="7" HorizontalAlignment="Center">
                                                                <labs:Shimmer Visibility="{x:Bind ViewModel.AuthCompanionCLS.AuthenticatedAccountsShimmerVisibility, Mode=OneWay}" />
                                                            </Grid>

                                                            <Grid Width="400" Height="45" CornerRadius="7" HorizontalAlignment="Center">
                                                                <labs:Shimmer Visibility="{x:Bind ViewModel.AuthCompanionCLS.AuthenticatedAccountsShimmerVisibility, Mode=OneWay}" />
                                                            </Grid>

                                                        </StackPanel>


                                                        <ListView HorizontalAlignment="Center"
                                                            Visibility="{x:Bind ViewModel.AuthCompanionCLS.AuthenticatedAccountsListViewVisibility, Mode=OneWay}"
                                                            BorderThickness="0"
                                                            CornerRadius="5"
                                                            ItemsSource="{x:Bind ViewModel.ViewModelMSGraph.AuthenticatedAccounts, Mode=OneWay}"
                                                            SelectedItem="{x:Bind ViewModel.AuthCompanionCLS.ListViewSelectedAccount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                            Height="300"
                                                            SelectionMode="Single">
                                                            <ListView.ItemTemplate>
                                                                <DataTemplate x:DataType="MSGraph:AuthenticatedAccounts">
                                                                    <Grid Padding="2,10,2,10">
                                                                        <Grid.Resources>
                                                                            <ResourceDictionary
                                                                                 Source="ms-appx:///Microsoft.UI.Xaml/DensityStyles/Compact.xaml"/>
                                                                        </Grid.Resources>
                                                                        <Grid.RowDefinitions>
                                                                            <RowDefinition Height="*"/>
                                                                            <RowDefinition Height="*"/>
                                                                            <RowDefinition Height="*"/>
                                                                            <RowDefinition Height="*"/>
                                                                        </Grid.RowDefinitions>
                                                                        <Grid.ColumnDefinitions>
                                                                            <ColumnDefinition Width="*"/>
                                                                        </Grid.ColumnDefinitions>

                                                                        <TextBox IsReadOnly="True" Header="UserName" Text="{x:Bind Username}" Grid.Column="0" Grid.Row="0"/>
                                                                        <TextBox IsReadOnly="True" Header="Tenant ID" Text="{x:Bind TenantID}" Margin="0,8,0,0" Grid.Column="0" Grid.Row="1"/>
                                                                        <TextBox IsReadOnly="True" Header="Account Identifier" Text="{x:Bind AccountIdentifier}" Margin="0,8,0,0" Grid.Column="0" Grid.Row="2"/>
                                                                        <TextBox IsReadOnly="True" Header="Permissions" Text="{x:Bind Permissions}" Margin="0,8,0,0" Grid.Column="0" Grid.Row="3"/>

                                                                    </Grid>
                                                                </DataTemplate>
                                                            </ListView.ItemTemplate>

                                                        </ListView>

                                                    </StackPanel>

                                                </controls:Case>
                                            </controls:SwitchPresenter>

                                        </StackPanel>

                                    </Flyout>
                                </Button.Flyout>
                            </Button>

                        </customUI:SettingsCardV2>

                        <controls:SettingsCard x:Uid="SelectIntuneGroupsSettingsCard"
                                               HeaderIcon="{ui:FontIcon Glyph=&#xF0B9;}"
                                               IsClickEnabled="False"
                                               IsActionIconVisible="False">

                            <controls:WrapPanel Orientation="Horizontal" HorizontalSpacing="15" VerticalSpacing="15">

                                <Button IsEnabled="{x:Bind ViewModel.AreOnlineFeaturesEnabled, Mode=OneWay}"
                                        x:Uid="RefreshButton"
                                        Click="{x:Bind ViewModel.RefreshIntuneGroupsButton_Click}" />

                                <customUI:ListViewV3 SelectionMode="Multiple"
                                          ItemsSource="{x:Bind ViewModel.GroupNamesCollection, Mode=OneWay}"
                                          MaxHeight="400"
                                          MaxWidth="400"
                                          ScrollViewer.HorizontalScrollMode="Enabled"
                                          ScrollViewer.IsHorizontalRailEnabled="True"
                                          ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                          ShowsScrollingPlaceholders="True"
                                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                                          IsEnabled="{x:Bind ViewModel.AreOnlineFeaturesEnabled, Mode=OneWay}"
                                          RegistryKey="Deployment_IntuneGroupsListView">
                                    <customUI:ListViewV3.ItemTemplate>
                                        <DataTemplate x:DataType="MSGraph:IntuneGroupItemListView">
                                            <TextBlock Text="{x:Bind GroupName}" TextWrapping="Wrap" Margin="5" MaxWidth="380" />
                                        </DataTemplate>
                                    </customUI:ListViewV3.ItemTemplate>
                                </customUI:ListViewV3>

                            </controls:WrapPanel>

                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <controls:SettingsCard x:Uid="DeployUnsignedXMLPolicyFilesSettingsCard"
                                       HeaderIcon="{ui:FontIcon Glyph=&#xE82D;}"
                                       IsClickEnabled="False"
                                       IsActionIconVisible="False">

                    <controls:WrapPanel HorizontalSpacing="15" VerticalSpacing="15">

                        <customUI:ButtonV2 x:Name="BrowseForXMLPolicyFilesButton"
                                           IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}"
                                           Click="{x:Bind ViewModel.BrowseForXMLPolicyFilesButton_Click}">
                            <customUI:ButtonV2.Content>
                                <controls:WrapPanel Orientation="Horizontal">

                                    <AnimatedIcon Visibility="{x:Bind ViewModel.UnsignedXMLFilesLightAnimatedIconVisibility, Mode=OneWay}" Height="20" Margin="0,0,5,0" Width="20">
                                        <AnimatedIcon.Source>
                                            <animatedvisuals:Light/>
                                        </AnimatedIcon.Source>
                                    </AnimatedIcon>

                                    <TextBlock x:Uid="BrowseTextBlock" />

                                </controls:WrapPanel>
                            </customUI:ButtonV2.Content>

                            <customUI:ButtonV2.Flyout>
                                <Flyout x:Name="BrowseForXMLPolicyFilesButton_Flyout">

                                    <controls:WrapPanel Orientation="Vertical" HorizontalSpacing="15" VerticalSpacing="15">

                                        <Button x:Uid="ClearButton"
                                                Click="{x:Bind ViewModel.BrowseForXMLPolicyFilesButton_Flyout_Clear_Click}" />

                                        <TextBlock x:Uid="ViewSelectedXMLFileTextBlock" TextWrapping="WrapWholeWords" />

                                        <ListBox MinWidth="400"
                                                 SelectionMode="Single"
                                                 ItemsSource="{x:Bind ViewModel.XMLFiles, Mode=OneWay}" />

                                    </controls:WrapPanel>

                                </Flyout>
                            </customUI:ButtonV2.Flyout>

                        </customUI:ButtonV2>

                        <Button HorizontalAlignment="Center"                                
                                HorizontalContentAlignment="Center"
                                IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}"
                                Click="{x:Bind ViewModel.DeployUnsignedXMLButton_Click}">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal">
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <FontIcon Glyph="&#xE8B6;" Margin="0,0,8,0" />
                                        <TextBlock Text="Deploy"/>
                                    </StackPanel>
                                </StackPanel>
                            </Button.Content>

                        </Button>

                    </controls:WrapPanel>

                </controls:SettingsCard>


                <controls:SettingsExpander x:Uid="DeploySignedXMLPolicyFilesSettingsExpander"
                                           IsExpanded="True"
                                           HeaderIcon="{ui:FontIcon Glyph=&#xEF3F;}">

                    <controls:WrapPanel HorizontalSpacing="15" VerticalSpacing="15">

                        <customUI:ButtonV2 x:Name="BrowseForSignedXMLPolicyFilesButton"
                                           IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}"
                                           Click="{x:Bind ViewModel.BrowseForSignedXMLPolicyFilesButton_Click}">
                            <customUI:ButtonV2.Content>
                                <controls:WrapPanel Orientation="Horizontal">

                                    <AnimatedIcon Visibility="{x:Bind ViewModel.SignedXMLFilesLightAnimatedIconVisibility, Mode=OneWay}" Height="20" Margin="0,0,5,0" Width="20">
                                        <AnimatedIcon.Source>
                                            <animatedvisuals:Light/>
                                        </AnimatedIcon.Source>
                                    </AnimatedIcon>

                                    <TextBlock x:Uid="BrowseTextBlock" />

                                </controls:WrapPanel>
                            </customUI:ButtonV2.Content>

                            <customUI:ButtonV2.Flyout>
                                <Flyout x:Name="BrowseForSignedXMLPolicyFilesButton_Flyout">

                                    <controls:WrapPanel Orientation="Vertical" HorizontalSpacing="15" VerticalSpacing="15">

                                        <Button x:Uid="ClearButton"
                                                Click="{x:Bind ViewModel.BrowseForSignedXMLPolicyFilesButton_Flyout_Clear_Click}" />

                                        <TextBlock x:Uid="ViewSelectedXMLFileTextBlock" TextWrapping="WrapWholeWords" />

                                        <ListBox MinWidth="400"
                                                 SelectionMode="Single"
                                                 ItemsSource="{x:Bind ViewModel.SignedXMLFiles, Mode=OneWay}" />

                                    </controls:WrapPanel>

                                </Flyout>
                            </customUI:ButtonV2.Flyout>

                        </customUI:ButtonV2>

                        <Button HorizontalAlignment="Center"
                                IsEnabled="{x:Bind ViewModel.DeploySignedXMLButtonIsEnabled, Mode=OneWay}"
                                HorizontalContentAlignment="Center" Click="{x:Bind ViewModel.DeploySignedXMLButton_Click}">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal">
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <FontIcon Glyph="{x:Bind ViewModel.DeploySignedXMLButtonFontIcon, Mode=OneWay}" Margin="0,0,8,0" />
                                        <TextBlock Text="{x:Bind ViewModel.DeploySignedXMLButtonContentTextBlock, Mode=OneWay}"/>
                                    </StackPanel>
                                </StackPanel>
                            </Button.Content>

                        </Button>

                    </controls:WrapPanel>

                    <controls:SettingsExpander.Items>

                        <customUI:SettingsCardV2
                             Description="Only creates signed CIP file(s) in the user config directory without deploying them. Toggle this if you want to deploy them on another system."
                             Header="Sign Only - No Deployment"
                             HeaderIcon="{ui:FontIcon Glyph=&#xF572;}" IsClickEnabled="True" IsActionIconVisible="False">

                            <ToggleSwitch IsOn="{x:Bind ViewModel.SignOnlyNoDeployToggleSwitch, Mode=TwoWay}"
                                          x:Uid="ToggleSwitchGeneral"
                                          IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}"/>

                        </customUI:SettingsCardV2>

                    </controls:SettingsExpander.Items>

                </controls:SettingsExpander>


                <controls:SettingsCard x:Uid="DeployCIPFilesSettingsCard"
                                       HeaderIcon="{ui:FontIcon Glyph=&#xEF3E;}"
                                       IsClickEnabled="False"
                                       IsActionIconVisible="False" >

                    <controls:WrapPanel HorizontalSpacing="15" VerticalSpacing="15">

                        <customUI:ButtonV2 x:Uid="FileBrowseButton"
                                           IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}"
                                           Click="{x:Bind ViewModel.BrowseForCIPBinaryFilesButton_Click}">

                            <customUI:ButtonV2.Flyout>
                                <Flyout>

                                    <controls:WrapPanel Orientation="Vertical" HorizontalSpacing="15" VerticalSpacing="15">

                                        <Button x:Uid="ClearButton"
                                                Click="{x:Bind ViewModel.BrowseForCIPBinaryFilesButton_Flyout_Clear_Click}" />

                                        <TextBlock Text="View the CIP files you selected." TextWrapping="WrapWholeWords" />

                                        <ListBox MinWidth="400"
                                                 SelectionMode="Single"
                                                 ItemsSource="{x:Bind ViewModel.CIPFiles, Mode=OneWay}" />

                                    </controls:WrapPanel>

                                </Flyout>
                            </customUI:ButtonV2.Flyout>

                        </customUI:ButtonV2>

                        <Button HorizontalAlignment="Center"                                
                                IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}"
                                HorizontalContentAlignment="Center"
                                Click="{x:Bind ViewModel.DeployCIPButton_Click}">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal">

                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <FontIcon Glyph="&#xE8B6;" Margin="0,0,8,0" />
                                        <TextBlock Text="Deploy"/>
                                    </StackPanel>

                                </StackPanel>
                            </Button.Content>

                        </Button>

                    </controls:WrapPanel>

                </controls:SettingsCard>

                <controls:SettingsCard x:Uid="ConvertXMLToBinarySettingsCard"
                                       HeaderIcon="{ui:FontIcon Glyph=&#xF003;}"
                                       IsClickEnabled="False"
                                       IsActionIconVisible="False" >

                    <controls:WrapPanel HorizontalSpacing="15" VerticalSpacing="15">

                        <customUI:ButtonV2 x:Uid="FileBrowseButton"
                                           IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}"
                                           Click="{x:Bind ViewModel.BrowseForXMLPolicesButton_Click}">

                            <customUI:ButtonV2.Flyout>
                                <Flyout>

                                    <controls:WrapPanel Orientation="Vertical" HorizontalSpacing="15" VerticalSpacing="15">

                                        <Button x:Uid="ClearButton"
                                                Click="{x:Bind ViewModel.BrowseForXMLPolicesButton_Flyout_Clear_Click}" />

                                        <TextBlock Text="View the XML files you selected." TextWrapping="WrapWholeWords" />

                                        <ListBox MinWidth="400"
                                                 SelectionMode="Single"
                                                 ItemsSource="{x:Bind ViewModel.XMLFilesToConvertToCIP, Mode=OneWay}" />

                                    </controls:WrapPanel>

                                </Flyout>
                            </customUI:ButtonV2.Flyout>

                        </customUI:ButtonV2>

                        <Button HorizontalAlignment="Center"                                
                                IsEnabled="{x:Bind ViewModel.AreElementsEnabled, Mode=OneWay}"
                                HorizontalContentAlignment="Center"
                                Click="{x:Bind ViewModel.ConvertXMLToCIPButton_Click}">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal">

                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <FontIcon Glyph="&#xE8B1;" Margin="0,0,8,0" />
                                        <TextBlock Text="Convert"/>
                                    </StackPanel>

                                </StackPanel>
                            </Button.Content>

                        </Button>

                    </controls:WrapPanel>

                </controls:SettingsCard>

            </StackPanel>

        </Grid>
    </ScrollViewer>
</Page>
