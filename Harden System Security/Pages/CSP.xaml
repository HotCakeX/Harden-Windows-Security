<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="HardenSystemSecurity.Pages.CSP"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:customUI="using:AppControlManager.CustomUIElements"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:vm="using:HardenSystemSecurity.ViewModels"
    FlowDirection="{x:Bind ViewModel.AppSettings.ApplicationGlobalFlowDirection, Mode=OneWay}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- InfoBar -->
        <customUI:InfoBarV2 Grid.Row="0"
                            IsOpen="{x:Bind ViewModel.MainInfoBarIsOpen, Mode=TwoWay}"
                            Message="{x:Bind ViewModel.MainInfoBarMessage, Mode=OneWay}"
                            Severity="{x:Bind ViewModel.MainInfoBarSeverity, Mode=OneWay}"
                            IsClosable="{x:Bind ViewModel.MainInfoBarIsClosable, Mode=OneWay}" />

        <!-- Toolbar -->
        <Border Grid.Row="1" Margin="0,5,0,5" Style="{StaticResource GridCardStyle}" Padding="8">
            <controls:WrapPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" HorizontalSpacing="10" VerticalSpacing="10">

                <!-- ProgressRing -->
                <ProgressRing Visibility="{x:Bind ViewModel.ProgressBarVisibility, Mode=OneWay}"
                              IsIndeterminate="{x:Bind ViewModel.IsLoadingIndeterminate, Mode=OneWay}"
                              Value="{x:Bind ViewModel.ProgressValue, Mode=OneWay}"
                              Maximum="100" />

                <!-- Browse Button -->
                <Button x:Uid="FileBrowseButton"
                        Click="{x:Bind ViewModel.BrowseForDdfFiles_Click}"
                        IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}">
                    <Button.ContentTemplate>
                        <DataTemplate x:DataType="x:String">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xEC50;" FontSize="16"/>
                                <TextBlock Text="{x:Bind}"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>

                <!-- Load Button -->
                <Button x:Uid="LoadAndProcessDDFDataButton"
                        Click="{x:Bind ViewModel.LoadData_Click}"
                        IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}">
                    <Button.ContentTemplate>
                        <DataTemplate x:DataType="x:String">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE9F5;" FontSize="16"/>
                                <TextBlock Text="{x:Bind}"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>

                <!-- Clear Button -->
                <Button x:Uid="ClearDataButton"
                        Click="{x:Bind ViewModel.ClearData_Click}"
                        IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}">
                    <Button.ContentTemplate>
                        <DataTemplate x:DataType="x:String">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE74D;" FontSize="16"/>
                                <TextBlock Text="{x:Bind}"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>

                <!-- Total chip -->
                <ToggleButton CornerRadius="8"
                        IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        Padding="10,6"
                        BorderThickness="1"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        IsChecked="{x:Bind ViewModel.OnlyShowingAppliedValues, Mode=TwoWay}">
                    <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                        <FontIcon Glyph="&#xE8A9;" />
                        <TextBlock VerticalAlignment="Center">
                        <Run x:Uid="TotalText" />
                        <Run Text="{x:Bind ViewModel.Policies.Count, Mode=OneWay}" FontWeight="SemiBold" />
                        </TextBlock>
                    </StackPanel>
                </ToggleButton>

                <!-- Source Info -->
                <Border CornerRadius="8" Padding="10,6" BorderThickness="1"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <FontIcon Glyph="&#xE9CE;" FontSize="14"/>
                        <TextBlock Text="{x:Bind ViewModel.DataSourceName, Mode=OneWay}" FontWeight="Medium" />
                    </StackPanel>
                </Border>

                <!-- Search Box -->
                <TextBox x:Uid="SearchBoxTextBox"
                         Text="{x:Bind ViewModel.SearchKeyword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}" />

                <Button VerticalAlignment="Center"
                        x:Uid="ExportToJsonButton"
                        IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}"
                        Click="{x:Bind ViewModel.ExportToJson_Click}">
                    <Button.ContentTemplate>
                        <DataTemplate x:DataType="x:String">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                                <TextBlock Text="{x:Bind}"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>

            </controls:WrapPanel>
        </Border>

        <customUI:ListViewV2 Grid.Row="2"
                             RegistryKey="CSPData"
                             IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}"
                             ItemsSource="{x:Bind ViewModel.Policies, Mode=OneWay}"
                             SelectionMode="Extended">

            <customUI:ListViewV2.ItemTemplate>
                <DataTemplate x:DataType="vm:CspPolicyEntry" xmlns:VMs="using:HardenSystemSecurity.ViewModels">
                    <Border BorderThickness="1"
                            BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}"
                            CornerRadius="8"
                            Padding="16"
                            Margin="0,4,12,4"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">

                        <StackPanel Spacing="10">

                            <StackPanel.Resources>
                                <ResourceDictionary
                                    Source="ms-appx:///Microsoft.UI.Xaml/DensityStyles/Compact.xaml"/>
                            </StackPanel.Resources>

                            <!-- Name -->
                            <TextBlock Text="{x:Bind Name}"
                                       Style="{ThemeResource SubtitleTextBlockStyle}"
                                       TextWrapping="Wrap" />

                            <!-- OMA-URI -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="OMA-URI" FontSize="12" FontWeight="SemiBold" />
                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <Button Padding="6,4" Click="{x:Bind VMs:ViewModelProvider.CSPVM.CopyOmaUri_Click}">
                                        <FontIcon Glyph="&#xE8C8;" FontSize="12"/>
                                    </Button>

                                    <TextBlock Grid.Column="1"
                                               Text="{x:Bind OmaUri}"
                                               FontFamily="Consolas"
                                               VerticalAlignment="Center"
                                               Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                                               IsTextSelectionEnabled="True"
                                               TextWrapping="Wrap"/>
                                </Grid>
                            </StackPanel>

                            <!-- Current Value -->
                            <StackPanel Spacing="8">
                                <TextBlock x:Uid="CurrentValueHeader" FontSize="12" FontWeight="SemiBold" />
                                <TextBox Text="{x:Bind CurrentValue}"
                                         IsReadOnly="True"
                                         BorderThickness="1"
                                         TextWrapping="Wrap"
                                         MaxHeight="140"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>

                            <!-- Default Value -->
                            <StackPanel Spacing="8">
                                <TextBlock x:Uid="DefaultValueHeader" FontSize="12" FontWeight="SemiBold" />
                                <TextBox Text="{x:Bind DefaultValue}"
                                         IsReadOnly="True"
                                         BorderThickness="1"
                                         TextWrapping="Wrap"
                                         MaxHeight="140"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>

                            <!-- Access Types -->
                            <StackPanel Spacing="8">
                                <TextBlock x:Uid="AccessTypeHeader" FontSize="12" FontWeight="SemiBold" />
                                <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}" CornerRadius="6" Padding="6">
                                    <TextBlock Text="{x:Bind AccessTypes}"
                                               FontSize="12"
                                               Foreground="{ThemeResource SystemBaseMediumColor}"
                                               TextWrapping="Wrap"/>
                                </Border>
                            </StackPanel>

                            <!-- Data Format + Scope -->
                            <StackPanel Spacing="8">
                                <controls:WrapPanel HorizontalSpacing="16" VerticalSpacing="8">
                                    <!-- Data Format -->
                                    <StackPanel Spacing="6">
                                        <TextBlock x:Uid="FormatHeader" FontSize="12" FontWeight="SemiBold" />
                                        <Border Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="6" Padding="6">
                                            <TextBlock Text="{x:Bind Format}"
                                                       FontSize="12"
                                                       HorizontalAlignment="Center"
                                                       FontWeight="SemiBold"
                                                       TextWrapping="Wrap"/>
                                        </Border>
                                    </StackPanel>

                                    <!-- Scope -->
                                    <StackPanel Spacing="6">
                                        <TextBlock x:Uid="ScopeHeader" FontSize="12" FontWeight="SemiBold" />
                                        <Border Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="6" Padding="6">
                                            <TextBlock Text="{x:Bind Scope}"
                                                       FontSize="12"
                                                       HorizontalAlignment="Center"
                                                       TextWrapping="Wrap"/>
                                        </Border>
                                    </StackPanel>
                                </controls:WrapPanel>
                            </StackPanel>

                            <!-- Allowed Values -->
                            <StackPanel Spacing="8">
                                <TextBlock x:Uid="AllowedValuesHeader" FontSize="12" FontWeight="SemiBold" />
                                <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}" CornerRadius="6" Padding="6">
                                    <TextBlock Text="{x:Bind AllowedValues}"
                                               FontSize="12"
                                               IsTextSelectionEnabled="True"
                                               TextWrapping="Wrap"/>
                                </Border>
                            </StackPanel>

                            <!-- Description -->
                            <StackPanel Spacing="8">
                                <TextBlock x:Uid="DescriptionHeader"
                                           FontSize="12"
                                           FontWeight="SemiBold" />
                                <TextBlock Text="{x:Bind Description}"
                                           Style="{ThemeResource BodyTextBlockStyle}"
                                           Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                                           IsTextSelectionEnabled="True"
                                           TextWrapping="Wrap"/>
                            </StackPanel>

                        </StackPanel>

                        <!-- Context Menu -->
                        <Border.ContextFlyout>
                            <MenuFlyout>
                                <MenuFlyoutItem x:Uid="CopyRow"
                                                Icon="Copy"
                                                Click="{x:Bind VMs:ViewModelProvider.CSPVM.CopySelected_Click}" />
                            </MenuFlyout>
                        </Border.ContextFlyout>
                    </Border>
                </DataTemplate>
            </customUI:ListViewV2.ItemTemplate>

        </customUI:ListViewV2>
    </Grid>
</Page>