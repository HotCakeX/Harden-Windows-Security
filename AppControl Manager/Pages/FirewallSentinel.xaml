<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="AppControlManager.Pages.FirewallSentinel"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:customUI="using:AppControlManager.CustomUIElements"
    xmlns:win="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:animatedvisuals="using:AnimatedVisuals"
    FlowDirection="{x:Bind ViewModel.AppSettings.ApplicationGlobalFlowDirection, Mode=OneWay}">

    <ScrollViewer>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <customUI:InfoBarV2 Grid.Row="0"
                                Margin="0,0,0,10"
                                IsOpen="{x:Bind ViewModel.MainInfoBarIsOpen, Mode=TwoWay}"
                                Message="{x:Bind ViewModel.MainInfoBarMessage, Mode=OneWay}"
                                Severity="{x:Bind ViewModel.MainInfoBarSeverity, Mode=OneWay}"
                                IsClosable="{x:Bind ViewModel.MainInfoBarIsClosable, Mode=OneWay}"/>

            <Expander HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Stretch"
                      CornerRadius="8"
                      Background="{ThemeResource LayerFillColorAltBrush}"
                      BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                      BorderThickness="1"
                      VerticalAlignment="Top"
                      Grid.Row="1">
                <Expander.Header>
                    <Grid Margin="0,8,0,8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <controls:WrapPanel Grid.Row="0" Margin="0,0,0,20"
                                            Orientation="Horizontal"
                                            HorizontalAlignment="Center"
                                            HorizontalSpacing="12"
                                            VerticalSpacing="8">

                            <!-- Main Header Title and Description -->
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <TextBlock Text="Firewall Configuration" 
                                           Style="{ThemeResource SubtitleTextBlockStyle}"/>
                                <TextBlock Text="Select a protection profile to apply to the Windows Firewall." 
                                           Style="{ThemeResource BodyTextBlockStyle}" 
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            </StackPanel>

                            <DropDownButton Content="Actions"
                                            IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}"
                                            Grid.Row="0"
                                            HorizontalAlignment="Center">
                                <DropDownButton.Flyout>
                                    <MenuFlyout Placement="Bottom">
                                        <MenuFlyoutItem Text="Revert Changes" Click="{x:Bind ViewModel.RestoreFirewall}" />
                                        <MenuFlyoutItem Text="Open Backup Location" Click="{x:Bind ViewModel.OpenBackupDirectory}" />
                                        <MenuFlyoutItem Text="Delete backups" Click="{x:Bind ViewModel.ClearBackups}" />
                                    </MenuFlyout>
                                </DropDownButton.Flyout>
                            </DropDownButton>

                        </controls:WrapPanel>

                        <!-- Cards Container -->
                        <controls:WrapPanel Grid.Row="1" HorizontalSpacing="16" VerticalSpacing="16" HorizontalAlignment="Center">

                            <!-- Default Windows Card -->
                            <Grid Width="260"
                                  Height="220" 
                                  Padding="16" 
                                  CornerRadius="8" 
                                  BorderThickness="1" 
                                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Default Windows" Style="{ThemeResource BodyStrongTextBlockStyle}" Grid.Row="0"/>

                                <TextBlock Text="Restores the standard Windows Firewall rules and settings. This will revert any custom security policies applied by this tool."
                                       Style="{ThemeResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       TextWrapping="Wrap"
                                       Margin="0,8,0,12"
                                       Grid.Row="1"/>

                                <Button Content="Default Windows"
                                        IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}"
                                        Click="{x:Bind ViewModel.ConfigureFirewallForDefaultWindows}" 
                                        Style="{StaticResource AccentButtonStyle}" 
                                        HorizontalAlignment="Stretch" 
                                        Grid.Row="2"/>
                            </Grid>

                            <!-- Allow Microsoft Card -->
                            <Grid Width="260" Height="220" 
                                  Padding="16" 
                                  CornerRadius="8" 
                                  BorderThickness="1" 
                                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Allow Microsoft" Style="{ThemeResource BodyStrongTextBlockStyle}" Grid.Row="0"/>

                                <TextBlock Text="Permits all network traffic for binaries signed by Microsoft. Ensures Windows Update and Microsoft services function correctly."
                                       Style="{ThemeResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       TextWrapping="Wrap"
                                       Margin="0,8,0,12"
                                       Grid.Row="1"/>

                                <Button Content="Allow Microsoft"
                                        Click="{x:Bind ViewModel.ConfigureFirewallForAllowMicrosoft}"
                                        IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}"
                                        Style="{StaticResource AccentButtonStyle}" 
                                        HorizontalAlignment="Stretch" 
                                        Grid.Row="2"/>
                            </Grid>

                            <!-- Signed and Reputable Card -->
                            <Grid Width="260"
                                  Height="220" 
                                  Padding="16" 
                                  CornerRadius="8" 
                                  BorderThickness="1" 
                                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Signed &amp; Reputable" Style="{ThemeResource BodyStrongTextBlockStyle}" Grid.Row="0"/>

                                <TextBlock Text="Restricts network traffic to software with valid signatures and known good reputation. Provides the highest level of security."
                                       Style="{ThemeResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       TextWrapping="Wrap"
                                       Margin="0,8,0,12"
                                       Grid.Row="1"/>

                                <Button Content="Signed and Reputable"
                                        Click="{x:Bind ViewModel.ConfigureFirewallForSignedAndReputable}"
                                        IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}"
                                        Style="{StaticResource AccentButtonStyle}" 
                                        HorizontalAlignment="Stretch" 
                                        Grid.Row="2"/>
                            </Grid>

                        </controls:WrapPanel>
                    </Grid>
                </Expander.Header>
                <Expander.Content>

                    <ScrollViewer>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <StackPanel Spacing="4" Grid.Row="0" HorizontalAlignment="Center">
                                <TextBlock Text="Advanced" 
                                           Style="{ThemeResource SubtitleTextBlockStyle}"/>
                                <TextBlock Text="You can use this section to customize the Firewall policy deployment." 
                                           Style="{ThemeResource BodyTextBlockStyle}" 
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            </StackPanel>

                            <StackPanel Spacing="4" Margin="0,10,0,0" Grid.Row="1">
                                <controls:SettingsCard Description="Customize the Tag that will be attached for App ID Tagging."
                                                       Header="App ID Tag">
                                    <controls:SettingsCard.HeaderIcon>
                                        <FontIcon Glyph="&#xEC5A;"/>
                                    </controls:SettingsCard.HeaderIcon>
                                    <TextBox Text="{x:Bind ViewModel.AppIDTagTouse, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}"/>
                                </controls:SettingsCard>

                                <controls:SettingsCard Description="Customize the name of the firewall rule responsible for App ID Tagging."
                                                       Header="Firewall rule name">
                                    <controls:SettingsCard.HeaderIcon>
                                        <FontIcon Glyph="&#xE932;"/>
                                    </controls:SettingsCard.HeaderIcon>
                                    <TextBox Text="{x:Bind ViewModel.AppIDTagFirewallRuleName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}"/>
                                </controls:SettingsCard>


                                <controls:SettingsCard Description="Customize the description of the firewall rule responsible for App ID Tagging."
                                                       Header="Firewall rule description">
                                    <controls:SettingsCard.HeaderIcon>
                                        <FontIcon Glyph="&#xE70B;"/>
                                    </controls:SettingsCard.HeaderIcon>
                                    <TextBox Text="{x:Bind ViewModel.AppIDTagFirewallRuleDescription, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}"/>
                                </controls:SettingsCard>

                                <controls:SettingsCard Description="Customize the App Control policy's name responsible for App ID Tagging."
                                                       Header="App ID Tagging Policy Name">
                                    <controls:SettingsCard.HeaderIcon>
                                        <FontIcon Glyph="&#xE8AC;"/>
                                    </controls:SettingsCard.HeaderIcon>
                                    <TextBox Text="{x:Bind ViewModel.AppIDTagPolicyName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             IsEnabled="{x:Bind ViewModel.ElementsAreEnabled, Mode=OneWay}"/>
                                </controls:SettingsCard>

                            </StackPanel>

                        </Grid>
                    </ScrollViewer>
                </Expander.Content>
            </Expander>

        </Grid>
    </ScrollViewer>
</Page>